from __future__ import print_function

import zmq
import time
from random import choice
from random import randrange
import zmq
from datetime import datetime
from matplotlib.dates import date2num
#
#
# context = zmq.Context()
# socket = context.socket(zmq.SUB)
#
# socket.connect("tcp://127.0.0.1:2027")
#
# socket.setsockopt(zmq.SUBSCRIBE,"tick")
#
#
# while True:
#     string = socket.recv()
#     print(string + " " + str(date2num(datetime.now())))
#     print(len(string))


# def result_collector():
#
#     context = zmq.Context()
#     socket = context.socket(zmq.SUB)
#     socket.setsockopt(zmq.SUBSCRIBE, 'USD_CAD ')
#     socket.connect("tcp://127.0.0.1:5558")
#     while True:
#         msg = socket.recv()
#         print(msg)
#
# result_collector()

def publisher():
    stock_symbols = ['RAX', 'EMC', 'GOOG', 'AAPL', 'RHAT', 'AMZN']

    context = zmq.Context()
    socket = context.socket(zmq.PUB)
    socket.bind("tcp://127.0.0.1:4999")

    while True:
        time.sleep(3)
        # pick a random stock symbol
        stock_symbol = choice(stock_symbols)
        # set a random stock price
        stock_price = randrange(1, 100)

        # compose the message
        msg = "{0} ${1}".format(stock_symbol, stock_price)

        print("Sending Message: {0}".format(msg))

        # send the message
        socket.send(msg)
        # Python3 Note: Use the below line and comment
        # the above line out
        # socket.send_string(msg)

def subscriber():
    context = zmq.Context()
    socket = context.socket(zmq.SUB)
    socket.setsockopt(zmq.SUBSCRIBE, '')
    socket.bind("tcp://127.0.0.1:2027")

    while True:
        msg = socket.recv()
        # Python3 Note: Use the below line and comment
        # the above line out
        # msg = socket.recv_string()
        print(" msg - " + msg)


subscriber()

# publisher()
# subscriber()

# import sys
# import zmq
#
# port = "2027"
#
#
# # Socket to talk to server
# context = zmq.Context()
# socket = context.socket(zmq.SUB)
#
# socket.connect("tcp://localhost:%s" % port)
#
# # Subscribe to zipcode, default is NYC, 10001
# topicfilter = "tick"
# socket.setsockopt(zmq.SUBSCRIBE, topicfilter)
#
# # Process 5 updates
# total_value = 0
# for update_nbr in range(5):
#     string = socket.recv()
#     topic, messagedata = string.split()
#     total_value += int(messagedata)
#     print topic, messagedata
#
# print "Average messagedata value for topic '%s' was %dF" % (topicfilter, total_value / update_nbr)
#
#
#
#
#
#






# import zmq
    # import random
    # import sys
    # import time
    #
    # port = "2027"
    # if len(sys.argv) > 1:
    #     port =  sys.argv[1]
    #     int(port)
    #
    # context = zmq.Context()
    # socket = context.socket(zmq.PUB)
    # socket.bind("tcp://*:%s" % port)
    # while True:
    #     topic = random.randrange(9999,10005)
    #     messagedata = random.randrange(1,215) - 80
    #     print "%d %d" % (topic, messagedata)
    #     socket.send("%d %d" % (topic, messagedata))
    #     time.sleep(1)
